<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pizza</title>
  </head>
  <style>
    .l-box {
         padding: 1em;
     }

     .right {
       text-align: center;
     }
     .center {
       text-align: center;
     }

    .plus:hover {
      color: blue;
    }

    .add {

    }

    .circle {
      -moz-appearance: none;
      -webkit-appearance: none;
      background-color: #fff;
      border: none;
      outline: none;
      margin-left: -6px;
    }

    .modal {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transform: scale(1.1);
        transition: visibility 0s linear 0.25s, opacity 0.25s 0s, transform 0.25s;
    }
    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 1rem 1.5rem;
        width: 24rem;
        border-radius: 0.5rem;
    }

    .show-modal {
        opacity: 1;
        visibility: visible;
        transform: scale(1.0);
        transition: visibility 0s linear 0s, opacity 0.25s 0s, transform 0.25s;
    }


  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function() {

       // Modal Script
       var modal = document.querySelector(".modal");
       var triggers = document.querySelectorAll(".add");
       // Toppings Order Button
       var orderToppings = document.querySelector("#order");

       // Global Toppings count
       var count = 0;
       var allowedToppings = 0;

       // Get number of toppings allowed
       function getNumber(toppingNumber) {
         // Cheese (0) is already handled by Django Template
         if(toppingNumber == "Special") {
           return 5;
         }
         else if (toppingNumber == "Cheese") {
           return 0;
         }
         else if (toppingNumber == "1 Topping" || toppingNumber == "1 Item") {
           return 1;
         }
         else if (toppingNumber == "2 Toppings" || toppingNumber == "2 Items") {
           return 2;
         }
         else {
           return 3;
         }
       }

       // Setup Checkboxes div to call tally
       document.querySelector('#checkboxes').addEventListener('change', tally);
       // Tally number of current checked checkboxes
       function tally() {
         count = document.querySelectorAll('#checkboxes input[type="checkbox"]:checked').length;
         console.log(count);
         // enable submit button if toppings number is right
         if(count == allowedToppings) {
           orderToppings.disabled = false;
         }
         else {
           orderToppings.disabled = true;
         }
       }

       // Get infor about the pizza order. Pizza type and id number then display in modal
       function getOrder(type, id, toppingNumber) {
         let pizzaType = document.querySelector("#pizza-type");
         let pizzaID = document.querySelector("#pizza-id");
         let toppingLabel = document.querySelector("#toppings");
         // Get and Show topping number
         allowedToppings = getNumber(toppingNumber);
         pizzaType.value = type;
         pizzaID.value = id;
         toppingLabel.innerText = "Choose " + allowedToppings + " toppings"
         if(allowedToppings == 1) {
           toppingLabel.innerText = "Choose " + allowedToppings + " topping"
         }
         // Show the modal with given info
         modal.classList.toggle("show-modal");
       }

       // Add event listeners to each pizza button which requires more options
       triggers.forEach(function (e) {
         e.onclick = function () {
           let type = e.firstChild.value;
           let id = e.id;
           let toppingNumber = e.firstChild.name;
           getOrder(type, id, toppingNumber);
         }
       });


    });

  </script>
  <body>
    <div class="pure-menu pure-menu-horizontal">
      <a href="#" class="pure-menu-heading pure-menu-link">Pizza</a>
      <ul class="pure-menu-list ">
          <li class="pure-menu-item"><a href="#" class="pure-menu-link">Menu</a></li>
          <li class="pure-menu-item"><a href="#" class="pure-menu-link"><i class="fa fa-shopping-cart"></i> Cart</a></li>
          <li class="pure-menu-item"><a href="#" class="pure-menu-link">Logout</a></li>
      </ul>
    </div>
    <div class="pure-u-1">
      <div class="l-box center">
        <h1>Menu</h1>
      </div>
    </div>
    <div class="pure-g">
    <div class="pure-u-1-3">
      <h1>Hello, {{ user.first_name }}</h1>
      <ul>
        <li>Currently logged in as: {{ user.username }}</li>
        <li><a href="{% url 'logout' %}">Logout</a></li>
      </ul>
      <div class="modal">
        <div class="modal-content">
          <h1>Toppings</h1>
          <h3 id="toppings"></h3>
          <form action="{% url 'order' %}" method="post">{% csrf_token %}
            <input class="hidden" type="text" name="type" id="pizza-type" value="regular">
            <input class="hidden" type="text" name="order" id="pizza-id" value="0">
            <div id="checkboxes" class="pure-g">
              <div class="pure-u-1-2">
                {% for topping in toppings|slice:":10" %}
                <input type="checkbox" name="checks" value="{{topping}}"> {{topping}}<br>
                {% endfor %}
              </div>
              <div class="pure-u-1-2">
                {% for topping in toppings|slice:"10:" %}
                <input type="checkbox" name="checks" value="{{topping}}"> {{topping}}<br>
                {% endfor %}
              </div>
            </div>
            <div class="l-box center">
              <button class="pure-button" type="submit" id="order" disabled>Order</button>
            </div>
          </form>
        </div>
       </div>
    </div>
    <div class="pure-u-1-3">

      <div class="l-box">
        <h2>Pizzas</h2>
      <table class="pure-table pure-table-bordered">
        <thead>
            <tr>
                <th>Regular Pizza</th>
                <th>Small</th>
                <th>Large</th>
            </tr>
        </thead>

        <tbody>
          {% for regular in regulars %}
          {% if regular.size|stringformat:"s" == "Small" %}
          <tr>
                <td>{{ regular.choice }}</td>
                {% if regular.choice|stringformat:"s" == "Cheese" %}
                <td><form action="{% url 'order' %}" method="post">{% csrf_token %}<button class="btn circle" type="submit" name="order" value="{{regular.id}}"/><i class="fa fa-plus-circle plus"></i></button>${{ regular.price }}<input class="hidden" type="text" name="type" value="regular"></form></td>
                {% else %}
                <td><i class="fa fa-plus-circle plus add" id="{{regular.id}}"><input class="hidden" type="text" name="{{ regular.choice }}" value="regular"></i> ${{ regular.price }}</td>
                {% endif %}


          {% elif regular.size|stringformat:"s" == "Large" %}
            {% if regular.choice|stringformat:"s" == "Cheese" %}
            <td><form action="{% url 'order' %}" method="post">{% csrf_token %}<button class="btn circle" type="submit" name="order" value="{{regular.id}}" /><i class="fa fa-plus-circle plus"></i></button>${{ regular.price }}<input class="hidden" type="text" name="type" value="regular"></form></td>
            {% else %}
            <td><i class="fa fa-plus-circle plus add" id="{{regular.id}}"><input class="hidden" type="text" name="{{ regular.choice }}" value="regular"></i> ${{ regular.price }}</td>
            {% endif %}
          </tr>
          {% endif %}
          {% endfor %}
        </tbody>
    </table>
  </div>

  <div class="l-box">
  <table class="pure-table pure-table-bordered">
    <thead>
        <tr>
            <th>Sicilian Pizza</th>
            <th>Small</th>
            <th>Large</th>
        </tr>
    </thead>
    <tbody>
      {% for sicilian in sicilians %}
      {% if sicilian.size|stringformat:"s" == "Small" %}
        <tr>
            <td>{{ sicilian.choice }}</td>
            {% if sicilian.choice|stringformat:"s" == "Cheese" %}
            <td><form action="{% url 'order' %}" method="post">{% csrf_token %}<button class="btn circle" type="submit" name="order" value="{{sicilian.id}}" /><i class="fa fa-plus-circle plus"></i></button> ${{ sicilian.price }}<input class="hidden" type="text" name="type" value="sicilian"></form></td>
            {% else %}
            <td><i class="fa fa-plus-circle plus add" id="{{sicilian.id}}"><input class="hidden" type="text" name="{{ sicilian.choice }}" value="sicilian"></i> ${{ sicilian.price }}</td>
            {% endif %}


      {% elif sicilian.size|stringformat:"s" == "Large" %}
            {% if sicilian.choice|stringformat:"s" == "Cheese" %}
            <td><form action="{% url 'order' %}" method="post">{% csrf_token %}<button class="btn circle" type="submit" name="order" value="{{sicilian.id}}" /><i class="fa fa-plus-circle plus"></i></button> ${{ sicilian.price }}<input class="hidden" type="text" name="type" value="sicilian"></form></td>
            {% else %}
            <td><i class="fa fa-plus-circle plus add" id="{{sicilian.id}}"><input class="hidden" type="text" name="{{ sicilian.choice }}" value="sicilian"></i> ${{ sicilian.price }}</td>
            {% endif %}
        </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>
</div>


</div>
<div class="pure-u-1-3">
  <h5>Your Order:</h5>
  <ul>
    {% if cart_regulars or cart_sicilians %}
    {% for regular in cart_regulars %}
    <li>1 {{regular}}</li>
    {% endfor %}
    {% for sicilian in cart_sicilians %}
    <li>1 {{sicilian}}</li>
    {% endfor %}
    {% else %}
    <li> No items in your order yet! </li>
    {% endif %}

</ul>
</div>

  </body>
</html>
